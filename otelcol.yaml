receivers:
  otlp:
    protocols:
      grpc:
      http:

  jaeger:
    protocols:
      grpc:
        endpoint: "0.0.0.0:14250"
      thrift_binary:
        endpoint: "0.0.0.0:6832"
      thrift_compact:
        endpoint: "0.0.0.0:6831"
      thrift_http:
        endpoint: "0.0.0.0:14268"

  zipkin:
    endpoint: "0.0.0.0:9411"

processors:
  batch:
    send_batch_size: 10000
    timeout: 1s
  probabilistic_sampler:
    sampling_percentage: 1.0

exporters:
  otlp:
    endpoint: jaeger-collector.${kubernetes_namespace.tracing.metadata[0].name}.svc.cluster.local:4317
    tls:
      insecure: true

  otlp/newrelic:
    endpoint: https://otlp.nr-data.net:443
    headers:
      api-key: $NEW_RELIC_LICENSE_KEY

  prometheusremotewrite:
    endpoint: "https://aps-workspaces.us-east-1.amazonaws.com/workspaces/ws-2c681cb0-a0ed-44e8-b826-d004b44b59cd/api/v1/remote_write"
    auth:
      authenticator: sigv4auth

extensions:
  health_check:
    endpoint: "0.0.0.0:13133"

  sigv4auth:
    region: "us-east-1"
    service: "aps"

service:
  telemetry:
    logs:
      level: "debug"

  extensions: [ health_check, sigv4auth ]

  pipelines:
    traces:
      receivers: [ otlp ]
      processors: [ batch, probabilistic_sampler ]
      exporters: [ otlp, otlp/newrelic ]

    metrics:
      receivers: [ otlp ]
      processors: [ batch ]
      exporters: [ prometheusremotewrite ]
